"use strict";(self.webpackChunkapp_store=self.webpackChunkapp_store||[]).push([[422],{1422:(e,t,s)=>{s.r(t),s.d(t,{default:()=>y});var r=s(4848),c=s(6552),n=s(515),i=s(4984),o=s(429),a=s(294),d=s(4700),l=s(4274);const u={checkoutContainer:"Checkout-module_checkoutContainer-U_33V",summary:"Checkout-module_summary-CKTL2",oldPrice:"Checkout-module_oldPrice-X7J_x",discount:"Checkout-module_discount-hQYYR"};var h=s(5076),m=s(2565),p=s(6540),x=s(2390),j=s(7231),f=s(1458);const v=()=>{var e;const{products:t,order:s}=(()=>{var e;const t=(0,m.G)((e=>e.cart)),s=Object.keys(t),{data:r,isFetching:c}=(0,o.Kc)({ids:s},{refetchOnMountOrArgChange:!0}),n={products:s.map((e=>({id:e,quantity:t[e]}))).filter((e=>e.quantity>0)),status:h.Re.Processing};return{products:null!==(e=null==r?void 0:r.data)&&void 0!==e?e:[],order:n,isFetching:c}})(),{create:v}=(()=>{const[e,{isLoading:t,isSuccess:s,error:r}]=(0,h.xj)(),c=(0,m.j)();(0,j.u)({error:r}),(0,f.j)({isSuccess:s,mess:"Order created successfully"});const n=(0,i.Zp)();return(0,p.useEffect)((()=>{s&&(c((0,x.sX)()),n(a.bw.orders.path))}),[s]),{create:t=>{return s=void 0,r=void 0,n=function*(){yield e(t)},new((c=void 0)||(c=Promise))((function(e,t){function i(e){try{a(n.next(e))}catch(e){t(e)}}function o(e){try{a(n.throw(e))}catch(e){t(e)}}function a(t){var s;t.done?e(t.value):(s=t.value,s instanceof c?s:new c((function(e){e(s)}))).then(i,o)}a((n=n.apply(s,r||[])).next())}));var s,r,c,n},isLoading:t,isSuccess:s}})(),{totalPrice:y,totalOldPrice:P,totalDiscount:k}=(e=>{const t=e.reduce(((e,t)=>{var s;return e.totalPrice+=t.price,e.totalOldPrice+=null!==(s=t.oldPrice)&&void 0!==s?s:t.price,e}),{totalPrice:0,totalOldPrice:0}),s=t.totalOldPrice>0?100*(t.totalOldPrice-t.totalPrice)/t.totalOldPrice:0;return{totalPrice:t.totalPrice,totalOldPrice:t.totalOldPrice,totalDiscount:Math.round(s)}})(t),C=(0,i.Zp)(),g=null!==(e=t.map((e=>({key:e.id,render:()=>(0,r.jsx)(o.AA,{product:e})}))))&&void 0!==e?e:[];return(0,r.jsxs)("div",{className:u.checkoutContainer,children:[(0,r.jsx)("h1",{children:"Checkout"}),(0,r.jsx)("p",{children:"Please review your items and proceed to payment."}),(0,r.jsx)(l.p,{items:g}),(0,r.jsxs)("div",{className:u.summary,children:[(0,r.jsx)("h2",{children:"Order Summary"}),(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{children:"Total Price:"})," ",(0,r.jsx)("span",{children:(0,d.$)(y)})]}),P>y&&(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{children:"Old Price:"}),(0,r.jsx)("span",{className:u.oldPrice,children:(0,d.$)(P)})]}),k>0&&(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{children:"Discount:"})," ",(0,r.jsxs)("span",{className:u.discount,children:[k,"%"]})]})]}),(0,r.jsx)(c.A,{}),(0,r.jsxs)(n.Ay.Group,{children:[(0,r.jsx)(n.Ay,{onClick:()=>C(a.bw.cart.path),className:u.button,children:"Back to cart"}),(0,r.jsx)(n.Ay,{onClick:()=>{v(s)},className:u.button,children:"Create order"})]})]})},y=()=>(0,r.jsx)(v,{})},7231:(e,t,s)=>{s.d(t,{u:()=>i});var r=s(6540),c=s(3448),n=s(5515);const i=({form:e,error:t})=>{const{showError:s}=(0,c.J)();(0,r.useEffect)((()=>{if(t){(0,n.jS)(t),e&&e.setFields((0,n.z6)(t));const r=(0,n.bu)(t);r&&s(r)}}),[t,e,s])}},3448:(e,t,s)=>{s.d(t,{J:()=>n});var r=s(6540),c=s(582);const n=()=>{const e=(0,r.useContext)(c.N);if(!e)throw new Error("useMessage должен использоваться внутри <MessageProvider>");return e}},1458:(e,t,s)=>{s.d(t,{j:()=>n});var r=s(6540),c=s(3448);const n=({isSuccess:e,mess:t})=>{const{showSuccess:s}=(0,c.J)();(0,r.useEffect)((()=>{e&&s(t)}),[e,t,s])}},4274:(e,t,s)=>{s.d(t,{p:()=>n});var r=s(4848),c=s(6540);const n=({isGrid:e,items:t,lastItemRef:s,onLastItemChanged:c})=>0===t.length?(0,r.jsx)("div",{className:"RenderList-module_empty-VeKxm",children:"No items to display"}):(0,r.jsx)("ul",{className:void 0===e||e?"RenderList-module_listGrid-VEEh9":"RenderList-module_list-BF_R0",children:t.map(((e,n)=>(0,r.jsx)(o,{item:e,ref:a({items:t,index:n,lastItemRef:s,onLastItemChanged:c})},e.key)))}),i=(0,c.forwardRef)((({item:e},t)=>(0,r.jsx)("li",{id:e.key,ref:t,className:"RenderList-module_listItem-d2Xxn",children:e.render()})));i.displayName="ItemRef";const o=(0,c.memo)(i),a=({items:e,index:t,lastItemRef:s,onLastItemChanged:r})=>c=>{t===e.length-1&&s&&(s.current=c,r&&r(e[e.length-1].key))}}}]);
//# sourceMappingURL=422.5737ef4e8b8d563d407a.js.map