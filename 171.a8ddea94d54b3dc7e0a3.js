"use strict";(self.webpackChunkapp_store=self.webpackChunkapp_store||[]).push([[171],{3171:(e,t,s)=>{s.r(t),s.d(t,{default:()=>g});var r=s(4848),n=s(6552),a=s(2702),i=s(4716),o=s(8863);var c=s(6540),d=s(4753),u=s(9473),l=s(9862),m=s(7231),h=s(294);const f=()=>{const{hasMore:e,isFetching:t,items:s,handleLastItem:f}=(()=>{const e=(0,d.Zp)(),{isAuth:t}=(0,l.As)(),s=(0,c.useRef)([]),[n,a]=(0,c.useState)(1),[i,o]=(0,c.useState)(!0),[f,g]=(0,c.useState)([]),{data:p,isFetching:x,isLoading:v,error:I,refetch:R}=(0,u.Wm)({pagination:{pageSize:10,pageNumber:n},sorting:{type:"ASC",field:"createdAt"}},{refetchOnMountOrArgChange:!0});(0,m.u)({error:I}),(0,c.useEffect)((()=>{void 0===p&&(s.current=[],g([]),o(!0),a(1))}),[p]),(0,c.useEffect)((()=>{v&&x&&g([])}),[x,v]);const C=(0,c.useCallback)((()=>{i&&!x&&a((e=>e+1))}),[i,x]);return(0,c.useEffect)((()=>{p&&p.data.length>0&&!s.current.includes(n)&&p.pagination.pageNumber===n?(s.current.push(n),g((t=>[...t,...p.data.map((t=>((e,t)=>({key:e.id,render:()=>(0,r.jsx)(u.rm,{category:e,onClick:t})}))(t,(()=>e(`${h.bw.products.basePath}${t.id}`)))))]))):p&&p.data.length<10&&o(!1)}),[p,n]),{isAuth:t,isFetching:x,hasMore:i,items:f,refetch:R,handleLastItem:C}})();return(0,r.jsxs)("div",{className:"CategoryList-module_container-JHTbf",children:[(0,r.jsx)(o.A,{items:s,onLastItem:f}),(!e||t)&&(0,r.jsx)(n.A,{}),!e&&(0,r.jsx)(a.A,{className:"CategoryList-module_end-M57dM",children:"Все категории загружены"}),t&&(0,r.jsx)(i.A,{})]})},g=()=>(0,r.jsx)("div",{className:"CategoryPage-module_page-FRD00",children:(0,r.jsx)(f,{})})},7231:(e,t,s)=>{s.d(t,{u:()=>i});var r=s(6540),n=s(3448),a=s(5515);const i=({form:e,error:t})=>{const{showError:s}=(0,n.J)();(0,r.useEffect)((()=>{if(t){(0,a.jS)(t),e&&e.setFields((0,a.z6)(t));const r=(0,a.bu)(t);r&&s(r)}}),[t,e,s])}},3448:(e,t,s)=>{s.d(t,{J:()=>a});var r=s(6540),n=s(582);const a=()=>{const e=(0,r.useContext)(n.N);if(!e)throw new Error("useMessage должен использоваться внутри <MessageProvider>");return e}},4274:(e,t,s)=>{s.d(t,{p:()=>a});var r=s(4848),n=s(6540);const a=({isGrid:e,items:t,lastItemRef:s,onLastItemChanged:n})=>0===t.length?(0,r.jsx)("div",{className:"RenderList-module_empty-VeKxm",children:"No items to display"}):(0,r.jsx)("ul",{className:void 0===e||e?"RenderList-module_listGrid-VEEh9":"RenderList-module_list-BF_R0",children:t.map(((e,a)=>(0,r.jsx)(o,{item:e,ref:c({items:t,index:a,lastItemRef:s,onLastItemChanged:n})},e.key)))}),i=(0,n.forwardRef)((({item:e},t)=>(0,r.jsx)("li",{id:e.key,ref:t,className:"RenderList-module_listItem-d2Xxn",children:e.render()})));i.displayName="ItemRef";const o=(0,n.memo)(i),c=({items:e,index:t,lastItemRef:s,onLastItemChanged:r})=>n=>{t===e.length-1&&s&&(s.current=n,r&&r(e[e.length-1].key))}},8863:(e,t,s)=>{s.d(t,{A:()=>i});var r=s(4848),n=s(6540),a=s(4274);const i=({items:e,onLastItem:t})=>{const[s,i]=(0,n.useState)(""),o=(0,n.useRef)(""),c=(0,n.useRef)(null),d=(0,n.useRef)(!1),u=(0,n.useCallback)((e=>{const s=e[0];(null==s?void 0:s.isIntersecting)&&!d.current&&(d.current=!0,t())}),[t]);return(0,n.useEffect)((()=>{if(s===o.current)return;o.current=s;const e=new IntersectionObserver(u,{threshold:.5}),t=c.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}}),[u,s]),(0,n.useEffect)((()=>{d.current=!1}),[s]),(0,r.jsx)(a.p,{items:e,lastItemRef:c,onLastItemChanged:i})}}}]);
//# sourceMappingURL=171.a8ddea94d54b3dc7e0a3.js.map