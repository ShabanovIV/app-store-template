{"version":3,"file":"286.c0e57b15b53a8e955c49.js","mappings":"gQAKO,MCGMA,EAAW,KACtB,MAAM,MAAEC,EAAK,WAAEC,GDJM,M,MACrB,MAAMC,GAAM,QAAgBC,IAAU,QAAiBA,KACjDC,GAAO,QAAgBD,IAAU,QAAgBA,MACjD,KAAEE,EAAI,WAAEJ,EAAU,MAAEK,IAAU,QAClC,CAAEJ,OACF,CAAEK,2BAA2B,IAS/B,OAPA,EAAAC,EAAAC,GAAgB,CAAEH,UAOX,CACLN,MALe,IAAfE,EAAIQ,OACA,GACqE,QAApE,EAAAL,aAAI,EAAJA,EAAMA,KAAKM,KAAKC,IAAY,CAAGA,UAASC,OAAQT,EAAKQ,EAAQE,eAAO,QAAI,GAI7Eb,aACD,ECb6Bc,GACxBC,GAAW,UAEXC,EAAYjB,EAAMW,KAAKO,IAAQ,CACnCC,IAAKD,EAAIN,QAAQE,GACjBM,OAAQ,KAAM,SAACC,EAAA,GAAQ,CAACT,QAASM,EAAIN,QAASC,OAAQK,EAAIL,aAG5D,OACE,iBAAKS,UCjBqB,oCDiBQ,UAC/BrB,IACC,UAAC,KAAOsB,MAAK,YACX,SAAC,IAAI,KACL,SAAC,IAAK,CACJC,MAAO,CACLC,QAAS,OACTC,eAAgB,SAChBC,WAAY,UACb,iCAMP,SAACC,EAAA,EAAU,CAACC,QAAQ,EAAO7B,MAAOiB,KAClC,SAAC,IAAO,IACPjB,EAAMU,OAAS,IACd,UAAC,KAAOa,MAAK,YACX,SAAC,KAAM,CAACO,QAAS,IAAMd,EAAS,KAAOe,SAASC,MAAK,8BACrD,SAAC,KAAM,CAACF,QAAS,IAAMd,EAAS,KAAOiB,SAASD,MAAK,sCAI5D,EEpCH,EAJ2B,KAClB,SAACjC,EAAQ,G,oECOX,MAAMS,EAAkB,EAAY0B,OAAM5B,YAC/C,MAAM,UAAE6B,IAAc,UAEtB,IAAAC,YAAU,KACR,GAAI9B,EAAO,EACT,QAAmBA,GAEf4B,GACFA,EAAKG,WAAU,QAAkB/B,IAGnC,MAAMgC,GAAgB,QAA0BhC,GAC5CgC,GACFH,EAAUG,EAEd,IACC,CAAChC,EAAO4B,EAAMC,GAAW,C,yDCvBvB,MAAMI,EAAa,KACxB,MAAMC,GAAU,IAAAC,YAAW,KAC3B,IAAKD,EACH,MAAM,IAAIE,MAAM,6DAElB,OAAOF,CAAO,C,0DCPhB,MCUaZ,EAAyC,EACpDC,SACA7B,QACA2C,cACAC,uBAEqB,IAAjB5C,EAAMU,QACD,gBAAKY,UDjB0I,gCCiBnH,kCAInC,eAAIA,eAAsBuB,IAAXhB,GAAwBA,EDrBsB,mCAA1C,+BCqB0D,SAC1E7B,EAAMW,KAAI,CAACmC,EAAMC,KAChB,SAACC,EAAQ,CAEPF,KAAMA,EACNG,IAAKC,EAAc,CAAElD,QAAO+C,QAAOJ,cAAaC,uBAF3CE,EAAK3B,SAadgC,GAAU,IAAAC,aAAyC,EAAGN,QAAQG,KAClE,eAAInC,GAAIgC,EAAK3B,IAAK8B,IAAKA,EAAK3B,UDtCiF,mCCsCvD,SACnDwB,EAAK1B,aAGV+B,EAAQE,YAAc,UAEtB,MAAML,GAAW,IAAAM,MAAKH,GAEhBD,EAAgB,EACpBlD,QACA+C,QACAJ,cACAC,uBAOQW,IACFR,IAAU/C,EAAMU,OAAS,GAAKiC,IAChCA,EAAYa,QAAUD,EAClBX,GACFA,EAAkB5C,EAAMA,EAAMU,OAAS,GAAGS,KAE9C,C","sources":["webpack://app-store/./src/widgets/shop/CartList/model/useCart.ts","webpack://app-store/./src/widgets/shop/CartList/ui/CartList.tsx","webpack://app-store/./src/widgets/shop/CartList/ui/CartList.module.scss?b6f6","webpack://app-store/./src/pages/CartPage/CartPage.tsx","webpack://app-store/./src/shared/api/errors/useErrorHandler.ts","webpack://app-store/./src/shared/hooks/useMessage.ts","webpack://app-store/./src/shared/ui/RenderList/RenderList.module.scss?5ddc","webpack://app-store/./src/shared/ui/RenderList/RenderList.tsx"],"sourcesContent":["import { useGetProductsQuery } from 'src/entities/Product';\nimport { selectCartItems, selectProductIds } from 'src/features/Cart';\nimport { useErrorHandler } from 'src/shared/api/errors/useErrorHandler';\nimport { useAppSelector } from 'src/shared/hooks/store';\n\nexport const useCart = () => {\n  const ids = useAppSelector((state) => selectProductIds(state));\n  const cart = useAppSelector((state) => selectCartItems(state));\n  const { data, isFetching, error } = useGetProductsQuery(\n    { ids },\n    { refetchOnMountOrArgChange: true },\n  );\n  useErrorHandler({ error });\n\n  const items =\n    ids.length === 0\n      ? []\n      : (data?.data.map((product) => ({ product, amount: cart[product.id] })) ?? []);\n\n  return {\n    items,\n    isFetching,\n  };\n};\n","import { Button, Divider, Space, Spin } from 'antd';\nimport { useNavigate } from 'react-router-dom';\nimport { CartItem } from 'src/features/Cart';\nimport { ROUTES } from 'src/shared/config/routes';\nimport { RenderList } from 'src/shared/ui/RenderList/RenderList';\nimport styles from './CartList.module.scss';\nimport { useCart } from '../model/useCart';\n\nexport const CartList = () => {\n  const { items, isFetching } = useCart();\n  const navigate = useNavigate();\n\n  const cartItems = items.map((itm) => ({\n    key: itm.product.id,\n    render: () => <CartItem product={itm.product} amount={itm.amount} />,\n  }));\n\n  return (\n    <div className={styles.listWrapper}>\n      {isFetching && (\n        <Button.Group>\n          <Spin />\n          <Space\n            style={{\n              display: 'flex',\n              justifyContent: 'center',\n              alignItems: 'center',\n            }}\n          >\n            Cart loading...\n          </Space>\n        </Button.Group>\n      )}\n      <RenderList isGrid={false} items={cartItems} />\n      <Divider />\n      {items.length > 0 && (\n        <Button.Group>\n          <Button onClick={() => navigate(ROUTES.category.path)}>Back to catalog</Button>\n          <Button onClick={() => navigate(ROUTES.checkout.path)}>Proceed to Checkout</Button>\n        </Button.Group>\n      )}\n    </div>\n  );\n};\n","// extracted by mini-css-extract-plugin\nexport default {\"listWrapper\":\"CartList-module_listWrapper-UM6Qt\"};","import { CartList } from 'src/widgets/shop/CartList';\n\nconst CartPage: React.FC = () => {\n  return <CartList />;\n};\n\nexport default CartPage;\n","import { useEffect } from 'react';\nimport { FormInstance } from 'antd';\nimport { useMessage } from 'src/shared/hooks/useMessage';\nimport { extractFormErrors, extractWithoutFiledErrors, throwIfGlobalError } from './errorParser';\n\nexport interface UseErrorHandlerProps<TFields> {\n  error: unknown;\n  form?: FormInstance<TFields>;\n}\n\nexport const useErrorHandler = <TFields>({ form, error }: UseErrorHandlerProps<TFields>) => {\n  const { showError } = useMessage();\n\n  useEffect(() => {\n    if (error) {\n      throwIfGlobalError(error);\n\n      if (form) {\n        form.setFields(extractFormErrors(error));\n      }\n\n      const joinedMessage = extractWithoutFiledErrors(error);\n      if (joinedMessage) {\n        showError(joinedMessage);\n      }\n    }\n  }, [error, form, showError]);\n};\n","import { useContext } from 'react';\nimport { MessageContext } from 'src/shared/providers/MessageContext';\n\nexport const useMessage = () => {\n  const context = useContext(MessageContext);\n  if (!context) {\n    throw new Error('useMessage должен использоваться внутри <MessageProvider>');\n  }\n  return context;\n};\n","// extracted by mini-css-extract-plugin\nexport default {\"list\":\"RenderList-module_list-BF_R0\",\"listGrid\":\"RenderList-module_listGrid-VEEh9\",\"listItem\":\"RenderList-module_listItem-d2Xxn\",\"empty\":\"RenderList-module_empty-VeKxm\"};","import React, { forwardRef, memo } from 'react';\nimport { IRenderItem } from './IRenderItem';\nimport styles from './RenderList.module.scss';\n\nexport interface IRenderListProps {\n  isGrid?: boolean;\n  items: IRenderItem[];\n  lastItemRef?: React.RefObject<HTMLLIElement | null>;\n  onLastItemChanged?: (key: string) => void;\n}\n\nexport const RenderList: React.FC<IRenderListProps> = ({\n  isGrid,\n  items,\n  lastItemRef,\n  onLastItemChanged,\n}) => {\n  if (items.length === 0) {\n    return <div className={styles.empty}>No items to display</div>;\n  }\n\n  return (\n    <ul className={isGrid === undefined || isGrid ? styles.listGrid : styles.list}>\n      {items.map((item, index) => (\n        <ItemMemo\n          key={item.key}\n          item={item}\n          ref={setRefForLast({ items, index, lastItemRef, onLastItemChanged })}\n        />\n      ))}\n    </ul>\n  );\n};\n\ntype ListItemProps = {\n  item: IRenderItem;\n};\n\nconst ItemRef = forwardRef<HTMLLIElement, ListItemProps>(({ item }, ref) => (\n  <li id={item.key} ref={ref} className={styles.listItem}>\n    {item.render()}\n  </li>\n));\nItemRef.displayName = 'ItemRef';\n\nconst ItemMemo = memo(ItemRef);\n\nconst setRefForLast = ({\n  items,\n  index,\n  lastItemRef,\n  onLastItemChanged,\n}: {\n  items: IRenderItem[];\n  index: number;\n  onLastItemChanged?: (key: string) => void;\n  lastItemRef?: React.RefObject<HTMLLIElement | null>;\n}) => {\n  return (element: HTMLLIElement | null) => {\n    if (index === items.length - 1 && lastItemRef) {\n      lastItemRef.current = element;\n      if (onLastItemChanged) {\n        onLastItemChanged(items[items.length - 1].key);\n      }\n    }\n  };\n};\n"],"names":["CartList","items","isFetching","ids","state","cart","data","error","refetchOnMountOrArgChange","useErrorHandler","u","length","map","product","amount","id","useCart","navigate","cartItems","itm","key","render","Cart","className","Group","style","display","justifyContent","alignItems","RenderList","isGrid","onClick","category","path","checkout","form","showError","useEffect","setFields","joinedMessage","useMessage","context","useContext","Error","lastItemRef","onLastItemChanged","undefined","item","index","ItemMemo","ref","setRefForLast","ItemRef","forwardRef","displayName","memo","element","current"],"sourceRoot":""}