"use strict";(self.webpackChunkapp_store=self.webpackChunkapp_store||[]).push([[27],{1027:(e,t,s)=>{s.r(t),s.d(t,{default:()=>C});var n=s(4848),a=s(6540),r=s(2702),o=s(515),i=s(6966),c=s(6552),d=s(4716),l=s(9473),u=s(9220),m=s(9365);const h=e=>({name:[{required:!0,message:"Please enter a name"},{min:3,max:20,message:"Name must be between 3 and 20 characters"},{pattern:/^[a-zA-Zа-яА-Я0-9\s]+$/,message:"Name can only contain letters, numbers, and spaces"}],photo:[{pattern:/^(https?:\/\/.*\.(?:png|jpg|jpeg|gif|webp|svg))$/i,message:"Invalid photo URL"}]}[e]);var f=s(7231),g=s(1458);const p="create",y="update",x=({action:e,categoryId:t,onCreated:s})=>{const[r,i]=(0,a.useState)(e===p),[c]=u.A.useForm(),{data:x,isFetching:v}=((e,t,s)=>{const{data:n,refetch:a,isFetching:r,isSuccess:o,error:i}=(0,l.OU)(t,{skip:e});return(0,f.u)({form:s,error:i}),{data:n,refetch:a,isFetching:r,isSuccess:o}})(e===p,t,c),{update:j,isUpdating:C,isUpdateSuccess:w}=(e=>{const[t,{isLoading:s,isSuccess:n,error:a}]=(0,l.ez)();return(0,f.u)({form:e,error:a}),(0,g.j)({isSuccess:n,mess:"Data saved successfully"}),{update:()=>{return s=void 0,n=void 0,r=function*(){const s=e.getFieldsValue();yield t(s)},new((a=void 0)||(a=Promise))((function(e,t){function o(e){try{c(r.next(e))}catch(e){t(e)}}function i(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,i)}c((r=r.apply(s,n||[])).next())}));var s,n,a,r},isUpdating:s,isUpdateSuccess:n}})(c),{create:A,isCreating:S,isCreatingSuccess:b}=(e=>{const[t,{isLoading:s,isSuccess:n,error:a}]=(0,l.XY)();return(0,f.u)({form:e,error:a}),(0,g.j)({isSuccess:n,mess:"Category created successfully"}),{create:()=>{return s=void 0,n=void 0,r=function*(){const s=e.getFieldsValue();yield t(s)},new((a=void 0)||(a=Promise))((function(e,t){function o(e){try{c(r.next(e))}catch(e){t(e)}}function i(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(o,i)}c((r=r.apply(s,n||[])).next())}));var s,n,a,r},isCreating:s,isCreatingSuccess:n}})(c);return(0,a.useEffect)((()=>{x&&c.setFieldsValue(x)}),[x,c]),(0,a.useEffect)((()=>{b&&s()}),[b,s]),(0,a.useEffect)((()=>{w&&i(!1)}),[w]),(0,n.jsxs)(u.A,{form:c,name:"CategoryForm",labelAlign:"left",labelCol:{span:8},wrapperCol:{span:16},onFinish:e===y?j:A,autoComplete:"off",children:[(0,n.jsx)(u.A.Item,{label:"Id",name:"id",hidden:e===p,children:(0,n.jsx)(m.A,{readOnly:!0})}),(0,n.jsx)(u.A.Item,{label:"Name",name:"name",rules:h("name"),children:(0,n.jsx)(m.A,{onChange:()=>i(!0),placeholder:"Name"})}),(0,n.jsx)(u.A.Item,{label:"Photo source",name:"photo",rules:h("photo"),children:(0,n.jsx)(m.A,{onChange:()=>i(!0),placeholder:"Photo source"})}),(0,n.jsx)(o.Ay,{type:"primary",htmlType:"submit",style:{width:"100%"},disabled:v||C||!r,children:C||S?(0,n.jsx)(d.A,{}):e===y?"Save":"Create"})]})};var v=s(4274);const j=()=>{var e;const[t,s]=(0,a.useState)(null),{data:u,error:m}=(0,l.lg)(),[h,{isLoading:j,isSuccess:C,error:w}]=(0,l.ec)();(0,f.u)({error:m}),(0,f.u)({error:w}),(0,g.j)({isSuccess:C,mess:"Category delete successfully"});const A=(0,a.useCallback)((e=>(0,n.jsxs)(r.A,{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,n.jsx)(o.Ay,{onClick:()=>{s({action:y,category:e})},children:"Edit"}),(0,n.jsx)(o.Ay,{danger:!0,onClick:()=>{return t=void 0,s=void 0,a=function*(){return yield h(e.id)},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{c(a.next(e))}catch(e){r(e)}}function i(e){try{c(a.throw(e))}catch(e){r(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,i)}c((a=a.apply(t,s||[])).next())}));var t,s,n,a},children:"Delete"})]})),[h]),S=(0,a.useCallback)((({category:e,onClick:t})=>({key:e.id,render:()=>(0,n.jsx)(l.rm,{category:e,onClick:t?()=>t(e.id):void 0,footer:()=>A?A(e):void 0})})),[A]),b=null!==(e=null==u?void 0:u.data.map((e=>S({category:e}))))&&void 0!==e?e:[];return(0,n.jsxs)("div",{className:"CategoryEditor-module_container-Jbx0A",children:[t&&(0,n.jsx)(i.A,{title:(0,n.jsx)("p",{children:"Edit category"}),open:Boolean(t),loading:!1,onCancel:()=>s(null),footer:(0,n.jsx)(n.Fragment,{}),children:(0,n.jsx)(x,{action:t.action,categoryId:t.category.id,onCreated:()=>{s(null)}})}),(0,n.jsx)("div",{children:(0,n.jsx)(o.Ay,{onClick:()=>{s({action:p,category:{id:"",name:"",commandId:"",createdAt:new Date(Date.now()),updatedAt:new Date(Date.now())}})},children:"Create new category"})}),(0,n.jsx)(c.A,{}),j&&(0,n.jsx)(d.A,{}),j&&(0,n.jsx)(c.A,{}),(0,n.jsx)(v.p,{items:b})]})},C=()=>(0,n.jsx)("div",{className:"CategoryEditPage-module_page-alh3f",children:(0,n.jsx)(j,{})})},7231:(e,t,s)=>{s.d(t,{u:()=>o});var n=s(6540),a=s(3448),r=s(5515);const o=({form:e,error:t})=>{const{showError:s}=(0,a.J)();(0,n.useEffect)((()=>{if(t){(0,r.jS)(t),e&&e.setFields((0,r.z6)(t));const n=(0,r.bu)(t);n&&s(n)}}),[t,e,s])}},3448:(e,t,s)=>{s.d(t,{J:()=>r});var n=s(6540),a=s(582);const r=()=>{const e=(0,n.useContext)(a.N);if(!e)throw new Error("useMessage должен использоваться внутри <MessageProvider>");return e}},1458:(e,t,s)=>{s.d(t,{j:()=>r});var n=s(6540),a=s(3448);const r=({isSuccess:e,mess:t})=>{const{showSuccess:s}=(0,a.J)();(0,n.useEffect)((()=>{e&&s(t)}),[e,t,s])}},4274:(e,t,s)=>{s.d(t,{p:()=>r});var n=s(4848),a=s(6540);const r=({isGrid:e,items:t,lastItemRef:s,onLastItemChanged:a})=>0===t.length?(0,n.jsx)("div",{className:"RenderList-module_empty-VeKxm",children:"No items to display"}):(0,n.jsx)("ul",{className:void 0===e||e?"RenderList-module_listGrid-VEEh9":"RenderList-module_list-BF_R0",children:t.map(((e,r)=>(0,n.jsx)(i,{item:e,ref:c({items:t,index:r,lastItemRef:s,onLastItemChanged:a})},e.key)))}),o=(0,a.forwardRef)((({item:e},t)=>(0,n.jsx)("li",{id:e.key,ref:t,className:"RenderList-module_listItem-d2Xxn",children:e.render()})));o.displayName="ItemRef";const i=(0,a.memo)(o),c=({items:e,index:t,lastItemRef:s,onLastItemChanged:n})=>a=>{t===e.length-1&&s&&(s.current=a,n&&n(e[e.length-1].key))}}}]);
//# sourceMappingURL=27.a4bd55e601efd001ef55.js.map