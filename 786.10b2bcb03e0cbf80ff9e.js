"use strict";(self.webpackChunkapp_store=self.webpackChunkapp_store||[]).push([[786],{3786:(e,t,s)=>{s.r(t),s.d(t,{default:()=>I});var r=s(4848),n=s(6540),a=s(2702),i=s(515),c=s(6966),o=s(6552),d=s(4716),l=s(429),u=s(9220),m=s(9365),h=s(126),p=s(2328),f=s(1764);const g=e=>({name:[{required:!0,message:"Please enter a name"},{min:3,max:40,message:"Name must be between 3 and 40 characters"}],photo:[{pattern:/^(https?:\/\/.*\.(?:png|jpg|jpeg|gif|webp|svg))$/i,message:"Invalid photo URL"}],price:[{required:!0,message:"Please enter a price"},{pattern:/^\d+(\.\d{1,2})?$/,message:"Price must be a valid number with up to 2 decimal places"}],oldPrice:[{pattern:/^\d+(\.\d{1,2})?$/,message:"Old price must be a valid number with up to 2 decimal places"}],categoryId:[{required:!0,message:"Please select a category product"}]}[e]);var x=s(7231),j=s(1458),v=s(9473);const y="create",C="update",A=({action:e,productId:t,onCreated:s})=>{const[a,c]=(0,n.useState)(e===y),[o]=u.A.useForm(),{data:A,dataCategories:w,isFetching:b}=((e,t,s)=>{const{data:r,isFetching:n,error:a}=(0,v.lg)(),{data:i,refetch:c,isFetching:o,isSuccess:d,error:u}=(0,l.hi)(t,{skip:e});return(0,x.u)({error:a}),(0,x.u)({form:s,error:u}),{data:i,dataCategories:r,refetch:c,isFetching:o||n,isSuccess:d}})(e===y,t,o),{update:I,isUpdating:P,isUpdateSuccess:S}=(e=>{const[t,{isLoading:s,isSuccess:r,error:n}]=(0,l.vM)();return(0,x.u)({form:e,error:n}),(0,j.j)({isSuccess:r,mess:"Data saved successfully"}),{update:()=>{return s=void 0,r=void 0,a=function*(){const s=e.getFieldsValue();yield t(s)},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{o(a.next(e))}catch(e){t(e)}}function c(e){try{o(a.throw(e))}catch(e){t(e)}}function o(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,c)}o((a=a.apply(s,r||[])).next())}));var s,r,n,a},isUpdating:s,isUpdateSuccess:r}})(o),{create:k,isCreating:E,isCreatingSuccess:F}=(e=>{const[t,{isLoading:s,isSuccess:r,error:n}]=(0,l.Q$)();return(0,x.u)({form:e,error:n}),(0,j.j)({isSuccess:r,mess:"Product created successfully"}),{create:()=>{return s=void 0,r=void 0,a=function*(){const s=e.getFieldsValue();yield t(s)},new((n=void 0)||(n=Promise))((function(e,t){function i(e){try{o(a.next(e))}catch(e){t(e)}}function c(e){try{o(a.throw(e))}catch(e){t(e)}}function o(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(i,c)}o((a=a.apply(s,r||[])).next())}));var s,r,n,a},isCreating:s,isCreatingSuccess:r}})(o);return(0,n.useEffect)((()=>{A&&o.setFieldsValue(Object.assign(Object.assign({},A),{categoryId:A.category.id}))}),[A,o]),(0,n.useEffect)((()=>{F&&s()}),[F,s]),(0,n.useEffect)((()=>{S&&c(!1)}),[S]),(0,r.jsxs)(u.A,{form:o,name:"ProductForm",labelAlign:"left",labelCol:{span:8},wrapperCol:{span:16},onFinish:e===C?I:k,autoComplete:"off",children:[(0,r.jsx)(u.A.Item,{label:"Id",name:"id",hidden:e===y,children:(0,r.jsx)(m.A,{readOnly:!0,hidden:e===y})}),(0,r.jsx)(u.A.Item,{label:"Name",name:"name",rules:g("name"),children:(0,r.jsx)(m.A,{onChange:()=>c(!0),placeholder:"Name"})}),(0,r.jsx)(u.A.Item,{label:"Photo source",name:"photo",rules:g("photo"),children:(0,r.jsx)(m.A,{onChange:()=>c(!0),placeholder:"Photo source"})}),(0,r.jsx)(u.A.Item,{label:"Description",name:"desc",children:(0,r.jsx)(m.A.TextArea,{onChange:()=>c(!0),placeholder:"Description"})}),(0,r.jsx)(u.A.Item,{label:"Old price",name:"oldPrice",rules:g("oldPrice"),children:(0,r.jsx)(h.A,{style:{width:"100%"},onChange:()=>c(!0),placeholder:"Old price"})}),(0,r.jsx)(u.A.Item,{label:"Price",name:"price",rules:g("price"),children:(0,r.jsx)(h.A,{style:{width:"100%"},onChange:()=>c(!0),placeholder:"Price"})}),(0,r.jsx)(u.A.Item,{label:"Category",name:"categoryId",rules:g("categoryId"),children:(0,r.jsx)(p.A,{placeholder:"Category",onChange:()=>c(!0),allowClear:!1,children:null==w?void 0:w.data.map((e=>(0,r.jsx)(f.c,{value:e.id,children:e.name},e.id)))})}),(0,r.jsx)(i.Ay,{type:"primary",htmlType:"submit",style:{width:"100%"},disabled:b||P||!a,children:P||E?(0,r.jsx)(d.A,{}):e===C?"Save":"Create"})]})};var w=s(4274);const b=()=>{var e;const[t,s]=(0,n.useState)(null),{data:u,error:m}=(0,l.r3)(),[h,{isLoading:p,isSuccess:f,error:g}]=(0,l.lY)();(0,x.u)({error:m}),(0,x.u)({error:g}),(0,j.j)({isSuccess:f,mess:"Product delete successfully"});const v=(0,n.useCallback)((e=>(0,r.jsxs)(a.A,{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,r.jsx)(i.Ay,{onClick:()=>{s({action:C,product:e})},children:"Edit"}),(0,r.jsx)(i.Ay,{danger:!0,onClick:()=>{return t=void 0,s=void 0,n=function*(){return yield h(e.id)},new((r=void 0)||(r=Promise))((function(e,a){function i(e){try{o(n.next(e))}catch(e){a(e)}}function c(e){try{o(n.throw(e))}catch(e){a(e)}}function o(t){var s;t.done?e(t.value):(s=t.value,s instanceof r?s:new r((function(e){e(s)}))).then(i,c)}o((n=n.apply(t,s||[])).next())}));var t,s,r,n},children:"Delete"})]})),[h]),b=(0,n.useCallback)((({product:e,onClick:t})=>({key:e.id,render:()=>(0,r.jsx)(l.AA,{product:e,onClick:t?()=>t(e.id):void 0,footer:()=>v?v(e):void 0})})),[v]),I=null!==(e=null==u?void 0:u.data.map((e=>b({product:e}))))&&void 0!==e?e:[];return(0,r.jsxs)("div",{className:"ProductEditor-module_container-HHjGH",children:[t&&(0,r.jsx)(c.A,{title:(0,r.jsx)("p",{children:"Edit product"}),open:Boolean(t),loading:!1,onCancel:()=>s(null),footer:(0,r.jsx)(r.Fragment,{}),children:(0,r.jsx)(A,{action:t.action,productId:t.product.id,onCreated:()=>{s(null)}})}),(0,r.jsx)("div",{children:(0,r.jsx)(i.Ay,{onClick:()=>{s({action:y,product:{id:"",name:"",createdAt:new Date(Date.now()),updatedAt:new Date(Date.now()),price:0,category:{id:""},commandId:""}})},children:"Create new product"})}),(0,r.jsx)(o.A,{}),p&&(0,r.jsx)(d.A,{}),p&&(0,r.jsx)(o.A,{}),(0,r.jsx)(w.p,{items:I})]})},I=()=>(0,r.jsx)("div",{className:"ProductEditPage-module_page-Kbjhx",children:(0,r.jsx)(b,{})})},7231:(e,t,s)=>{s.d(t,{u:()=>i});var r=s(6540),n=s(3448),a=s(5515);const i=({form:e,error:t})=>{const{showError:s}=(0,n.J)();(0,r.useEffect)((()=>{if(t){(0,a.jS)(t),e&&e.setFields((0,a.z6)(t));const r=(0,a.bu)(t);r&&s(r)}}),[t,e,s])}},3448:(e,t,s)=>{s.d(t,{J:()=>a});var r=s(6540),n=s(582);const a=()=>{const e=(0,r.useContext)(n.N);if(!e)throw new Error("useMessage должен использоваться внутри <MessageProvider>");return e}},1458:(e,t,s)=>{s.d(t,{j:()=>a});var r=s(6540),n=s(3448);const a=({isSuccess:e,mess:t})=>{const{showSuccess:s}=(0,n.J)();(0,r.useEffect)((()=>{e&&s(t)}),[e,t,s])}},4274:(e,t,s)=>{s.d(t,{p:()=>a});var r=s(4848),n=s(6540);const a=({isGrid:e,items:t,lastItemRef:s,onLastItemChanged:n})=>0===t.length?(0,r.jsx)("div",{className:"RenderList-module_empty-VeKxm",children:"No items to display"}):(0,r.jsx)("ul",{className:void 0===e||e?"RenderList-module_listGrid-VEEh9":"RenderList-module_list-BF_R0",children:t.map(((e,a)=>(0,r.jsx)(c,{item:e,ref:o({items:t,index:a,lastItemRef:s,onLastItemChanged:n})},e.key)))}),i=(0,n.forwardRef)((({item:e},t)=>(0,r.jsx)("li",{id:e.key,ref:t,className:"RenderList-module_listItem-d2Xxn",children:e.render()})));i.displayName="ItemRef";const c=(0,n.memo)(i),o=({items:e,index:t,lastItemRef:s,onLastItemChanged:r})=>n=>{t===e.length-1&&s&&(s.current=n,r&&r(e[e.length-1].key))}}}]);
//# sourceMappingURL=786.10b2bcb03e0cbf80ff9e.js.map